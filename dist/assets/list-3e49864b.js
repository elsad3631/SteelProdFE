import{g as B}from"./assets-0fb52c34.js";import{D as F,L as N}from"./KTDataTable-be20d7ae.js";import{S as y}from"./sweetalert2-86394131.js";import{a as T}from"./alphabet-a5bbf61c.js";import{m as E,r as m,av as w,_ as L,p as g,q as b,w as f,x as t,K as p,C as $,a0 as S,F as O,y as z,z as C,a5 as I,L as h,A,aw as D,o as R,M,a6 as U}from"./index-6e218937.js";import{a as V}from"./index-9afe0745.js";const K=E({name:"export-orders-modal",components:{},setup(){const e=m(null),o=m(!1),l=m({Filter:"",fromName:"A",toName:"Z",exportFormat:"excel"}),d=m({});return{formData:l,rules:d,submit:()=>{e.value&&e.value.validate(u=>{if(u){o.value=!0;let s=m(""),i=m("");if(l.value.exportFormat=="excel")s.value="ExportExcel",i.value=".xlsx";else if(l.value.exportFormat=="csv")s.value="ExportCsv",i.value=".csv";else{y.fire({text:"Attenzione, selezionare il formato del file.",icon:"error",buttonsStyling:!1,confirmButtonText:"Continua!",heightAuto:!1,customClass:{confirmButton:"btn btn-primary"}}),o.value=!1;return}w.get(`Orders/${s.value}?fromName=${l.value.fromName}&toName=${l.value.toName}`,"blob").then(a=>{const v=URL.createObjectURL(new Blob([a.data])),_=document.createElement("a");_.href=v,_.setAttribute("download","export commesse"+i.value),document.body.appendChild(_),_.click(),window.URL.revokeObjectURL(v),document.body.removeChild(_),o.value=!1,y.fire({text:"Operazione completata!",icon:"success",buttonsStyling:!1,confirmButtonText:"Continua!",heightAuto:!1,customClass:{confirmButton:"btn btn-primary"}})}).catch(({response:a})=>{console.log(a),o.value=!1,y.fire({text:"Attenzione, si è verificato un errore.",icon:"error",buttonsStyling:!1,confirmButtonText:"Continua!",heightAuto:!1,customClass:{confirmButton:"btn btn-primary"}})})}else return y.fire({text:"Attenzione, si è verificato un errore.",icon:"error",buttonsStyling:!1,confirmButtonText:"Continua!",heightAuto:!1,customClass:{confirmButton:"btn btn-primary"}}),!1})},formRef:e,loading:o,getAssetPath:B,alphabet:T}}});const X={class:"modal fade",id:"kt_export_modal",tabindex:"-1","aria-hidden":"true"},W={class:"modal-dialog modal-dialog-centered mw-650px"},q={class:"modal-content"},J={class:"modal-header"},H=t("h2",{class:"fw-bold"},"Export Commesse",-1),P={id:"kt_export_close","data-bs-dismiss":"modal",class:"btn btn-icon btn-sm btn-active-icon-primary"},G={class:"modal-body scroll-y mx-5 mx-xl-15 my-7"},Z={class:"fv-row mb-10"},Q=t("label",{class:"fs-5 fw-semobold form-label mb-5"},"Seleziona il range da lettera a lettera:",-1),Y={class:"input-group mb-5"},ee=["value"],te=t("span",{class:"input-group-text"},"-",-1),oe=["value"],ae={class:"fv-row mb-10"},se=t("label",{class:"fs-5 fw-semobold form-label mb-5"},"Seleziona il formato:",-1),ne=t("option",{value:"excel"},"Excel",-1),le=t("option",{value:"csv"},"CSV",-1),re=[ne,le],ie={class:"text-center"},de=t("button",{type:"reset",id:"kt_export_cancel",class:"btn btn-light me-3"}," Scarta ",-1),ce=["data-kt-indicator"],me={key:0,class:"indicator-label"},ue={key:1,class:"indicator-progress"},be=t("span",{class:"spinner-border spinner-border-sm align-middle ms-2"},null,-1);function fe(e,o,l,d,r,u){const s=g("KTIcon"),i=g("el-form");return b(),f("div",X,[t("div",W,[t("div",q,[t("div",J,[H,t("div",P,[p(s,{"icon-name":"cross","icon-class":"fs-1"})])]),t("div",G,[p(i,{onSubmit:o[3]||(o[3]=D(a=>e.submit(),["prevent"])),model:e.formData,rules:e.rules,ref:"formRef"},{default:$(()=>[t("div",Z,[Q,t("div",Y,[S(t("select",{class:"form-select","aria-label":"Select example","onUpdate:modelValue":o[0]||(o[0]=a=>e.formData.fromName=a)},[(b(!0),f(O,null,z(e.alphabet,a=>(b(),f("option",{key:a.name,value:a.name},C(a.name),9,ee))),128))],512),[[I,e.formData.fromName]]),te,S(t("select",{class:"form-select","aria-label":"Select example","onUpdate:modelValue":o[1]||(o[1]=a=>e.formData.toName=a)},[(b(!0),f(O,null,z(e.alphabet,a=>(b(),f("option",{key:a.name,value:a.name},C(a.name),9,oe))),128))],512),[[I,e.formData.toName]])])]),t("div",ae,[se,S(t("select",{class:"form-select","aria-label":"Select example","onUpdate:modelValue":o[2]||(o[2]=a=>e.formData.exportFormat=a)},re,512),[[I,e.formData.exportFormat]])]),t("div",ie,[de,t("button",{"data-kt-indicator":e.loading?"on":null,type:"submit",class:"btn btn-lg btn-primary"},[e.loading?A("",!0):(b(),f("span",me,[h(" Invia "),p(s,{"icon-name":"arrow-right","icon-class":"fs-3 ms-2 me-0"})])),e.loading?(b(),f("span",ue,[h(" Attendere... "),be])):A("",!0)],8,ce)])]),_:1},8,["model","rules"])])])])])}const pe=L(K,[["render",fe]]),_e=E({name:"add-order-modal",components:{},setup(e,{emit:o}){const l=m(null),d=m(null),r=m(!1),u=m({file:null}),s=m({file:[{required:!0,message:"Caricare il file",trigger:"change"}]}),i="Orders",a=()=>{l.value&&l.value.validate(_=>{if(_)r.value=!0,w.post_file(`${i}/InsertOperaXml`,u.value).then(()=>{r.value=!1,y.fire({text:"Operazione completata!",icon:"success",buttonsStyling:!1,confirmButtonText:"Continua!",heightAuto:!1,customClass:{confirmButton:"btn btn-primary"}}),o("formAddSubmitted",u.value)}).catch(({response:n})=>{console.log(n),r.value=!1,y.fire({text:"Attenzione, si è verificato un errore.",icon:"error",buttonsStyling:!1,confirmButtonText:"Continua!",heightAuto:!1,customClass:{confirmButton:"btn btn-primary"}})});else return r.value=!1,y.fire({text:"Attenzione, non tutti i campi sono corretti.",icon:"error",buttonsStyling:!1,confirmButtonText:"Continua!",heightAuto:!1,customClass:{confirmButton:"btn btn-primary"}}),!1})};function v(_){u.value.file=_.target.files[0]}return{formData:u,rules:s,submit:a,formRef:l,loading:r,addCustomerModalRef:d,getAssetPath:B,handleFileUpload:v}}}),he={class:"modal fade",id:"kt_modal_add",ref:"addModalRef",tabindex:"-1","aria-hidden":"true"},ve={class:"modal-dialog modal-dialog-centered mw-650px"},ge={class:"modal-content"},ye={class:"modal-header",id:"kt_modal_add_header"},$e=t("h2",{class:"fw-bold"},"Aggiungi accessorio",-1),ke={id:"kt_modal_add_close","data-bs-dismiss":"modal",class:"btn btn-icon btn-sm btn-active-icon-primary"},Ce={class:"modal-body py-10 px-lg-17"},xe={class:"scroll-y me-n7 pe-7",id:"kt_modal_add_scroll","data-kt-scroll":"true","data-kt-scroll-activate":"{default: false, lg: true}","data-kt-scroll-max-height":"auto","data-kt-scroll-dependencies":"#kt_modal_add_header","data-kt-scroll-wrappers":"#kt_modal_add_scroll","data-kt-scroll-offset":"300px"},we={class:"fv-row mb-7"},Se=t("label",{class:"required fs-6 fw-semobold mb-2"},"Carica il file",-1),Ae={class:"modal-footer flex-center"},Ie=t("button",{type:"reset",id:"kt_modal_add_cancel",class:"btn btn-light me-3"}," Scarta ",-1),Oe=["data-kt-indicator"],Be={key:0,class:"indicator-label"},Ee={key:1,class:"indicator-progress"},Le=t("span",{class:"spinner-border spinner-border-sm align-middle ms-2"},null,-1);function je(e,o,l,d,r,u){const s=g("KTIcon"),i=g("el-form");return b(),f("div",he,[t("div",ve,[t("div",ge,[t("div",ye,[$e,t("div",ke,[p(s,{"icon-name":"cross","icon-class":"fs-1"})])]),p(i,{onSubmit:o[1]||(o[1]=D(a=>e.submit(),["prevent"])),model:e.formData,rules:e.rules,ref:"formRef"},{default:$(()=>[t("div",Ce,[t("div",xe,[t("div",we,[Se,t("input",{class:"form-control",onChange:o[0]||(o[0]=(...a)=>e.handleFileUpload&&e.handleFileUpload(...a)),type:"file",placeholder:"Codice..."},null,32)])])]),t("div",Ae,[Ie,t("button",{"data-kt-indicator":e.loading?"on":null,class:"btn btn-lg btn-primary",type:"submit"},[e.loading?A("",!0):(b(),f("span",Be,[h(" Invia "),p(s,{"icon-name":"arrow-right","icon-class":"fs-2 me-2 me-0"})])),e.loading?(b(),f("span",Ee,[h(" Attendere... "),Le])):A("",!0)],8,Oe)])]),_:1},8,["model","rules"])])])],512)}const ze=L(_e,[["render",je]]),De=e=>w.get(`Orders/Get?currentPage=0&filterRequest=${e}`,"").then(({data:o})=>o.data.map(d=>{var r,u,s,i,a,v;return{id:d.id,job_id:(r=d.job)==null?void 0:r.job_id,job_name:(u=d.job)==null?void 0:u.job_name,cst_name:(i=(s=d.job)==null?void 0:s.operaJobCustomer)==null?void 0:i.cst_name,cst_code:(v=(a=d.job)==null?void 0:a.operaJobCustomer)==null?void 0:v.cst_code}})).catch(({response:o})=>(console.log(o),[])),Fe=E({name:"orders-list",components:{Datatable:F,ExportOrdersModal:pe,AddOrderModal:ze,Loading:N},setup(){let e=m(!0);const o=m([{columnName:"Id",columnLabel:"id",sortEnabled:!0,columnWidth:175},{columnName:"Job id",columnLabel:"job_id",sortEnabled:!0,columnWidth:230},{columnName:"Job name",columnLabel:"job_name",sortEnabled:!0,columnWidth:175},{columnName:"Cliente",columnLabel:"cst_name",sortEnabled:!0,columnWidth:175},{columnName:"Azioni",columnLabel:"actions",sortEnabled:!1,columnWidth:135}]),l=m([]);let d=m([]);async function r(c){d.value=await De(c),e.value=!1}R(()=>{e.value=!0,r("")});const u=()=>{l.value.forEach(c=>{s(c)}),l.value.length=0},s=c=>{e.value=!0,w.post(`Orders/Delete?id=${c}`,{}).then(()=>{r("")}).catch(({response:k})=>{console.log(k)})},i=m("");return{tableData:d,tableHeader:o,deleteItem:s,search:i,searchItems:()=>{r(i.value),M.reinitialization()},selectedIds:l,deleteFewItems:u,sort:c=>{const k=c.order==="asc";c.label&&V(d.value,c.label,{reverse:k})},onItemSelect:c=>{l.value=c},getAssetPath:B,loading:e,getItems:r,createXmlFileList:c=>{e.value=!0,w.get(`Orders/CreateXmlFileList?id=${c}`,"blob").then(k=>{const j=URL.createObjectURL(new Blob([k.data])),x=document.createElement("a");x.href=j,x.setAttribute("download","commessa_n_"+c+".zip"),document.body.appendChild(x),x.click(),window.URL.revokeObjectURL(j),document.body.removeChild(x),e.value=!1,y.fire({text:"Operazione completata!",icon:"success",buttonsStyling:!1,confirmButtonText:"Continua!",heightAuto:!1,customClass:{confirmButton:"btn btn-primary"}})}).catch(({response:k})=>{console.log(k),e.value=!1,y.fire({text:"Attenzione, si è verificato un errore.",icon:"error",buttonsStyling:!1,confirmButtonText:"Continua!",heightAuto:!1,customClass:{confirmButton:"btn btn-primary"}})})}}}}),Ne={class:"card"},Te={class:"card-header border-0 pt-6"},Re={class:"card-title"},Me={class:"d-flex align-items-center position-relative my-1"},Ue={class:"card-toolbar"},Ve={key:0,class:"d-flex justify-content-end","data-kt-customer-table-toolbar":"base"},Ke={type:"button",class:"btn btn-light-primary me-3","data-bs-toggle":"modal","data-bs-target":"#kt_export_modal"},Xe={type:"button",class:"btn btn-primary","data-bs-toggle":"modal","data-bs-target":"#kt_modal_add"},We={key:1,class:"d-flex justify-content-end align-items-center","data-kt-customer-table-toolbar":"selected"},qe={class:"fw-bold me-5"},Je={class:"me-2"},He=t("div",{class:"d-flex justify-content-end align-items-center d-none","data-kt-customer-table-toolbar":"selected"},[t("div",{class:"fw-bold me-5"},[t("span",{class:"me-2","data-kt-customer-table-select":"selected_count"}),h("Selezionati ")]),t("button",{type:"button",class:"btn btn-danger","data-kt-customer-table-select":"delete_selected"}," Elimina Selezionati ")],-1),Pe={class:"card-body pt-0"},Ge=["onClick"],Ze=["onClick"];function Qe(e,o,l,d,r,u){const s=g("KTIcon"),i=g("router-link"),a=g("Datatable"),v=g("AddOrderModal"),_=g("ExportOrdersModal");return b(),f(O,null,[t("div",Ne,[t("div",Te,[t("div",Re,[t("div",Me,[p(s,{"icon-name":"magnifier","icon-class":"fs-1 position-absolute ms-6"}),S(t("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=n=>e.search=n),onInput:o[1]||(o[1]=n=>e.searchItems()),class:"form-control form-control-solid w-250px ps-15",placeholder:"Ricerca"},null,544),[[U,e.search]])])]),t("div",Ue,[e.selectedIds.length===0?(b(),f("div",Ve,[t("button",Ke,[p(s,{"icon-name":"exit-up","icon-class":"fs-2"}),h(" Export ")]),t("button",Xe,[p(s,{"icon-name":"plus","icon-class":"fs-2"}),h(" Aggiungi commessa ")])])):(b(),f("div",We,[t("div",qe,[t("span",Je,C(e.selectedIds.length),1),h("Selezionati ")]),t("button",{type:"button",class:"btn btn-danger",onClick:o[2]||(o[2]=n=>e.deleteFewItems())}," Elimina Selezionati ")])),He])]),t("div",Pe,[p(a,{onOnSort:e.sort,onOnItemsSelect:e.onItemSelect,data:e.tableData,header:e.tableHeader,"enable-items-per-page-dropdown":!0,"checkbox-enabled":!0,"checkbox-label":"id",loading:e.loading},{id:$(({row:n})=>[h(C(n.id),1)]),job_id:$(({row:n})=>[p(i,{to:{name:"update-accessory",params:{id:n.id}},class:"text-gray-600 text-hover-primary mb-1"},{default:$(()=>[h(C(n.job_id),1)]),_:2},1032,["to"])]),job_name:$(({row:n})=>[h(C(n.job_name),1)]),cst_name:$(({row:n})=>[h(C(n.cst_name),1)]),actions:$(({row:n})=>[t("button",{onClick:c=>e.createXmlFileList(n.id),class:"btn btn-light-success me-1"},"Crea XFL",8,Ge),t("button",{onClick:c=>e.deleteItem(n.id),class:"btn btn-light-danger me-1"},"Elimina",8,Ze)]),_:1},8,["onOnSort","onOnItemsSelect","data","header","loading"])])]),p(v,{onFormAddSubmitted:o[3]||(o[3]=n=>e.getItems(""))}),p(_)],64)}const nt=L(Fe,[["render",Qe]]);export{nt as default};
